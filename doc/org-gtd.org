#+TITLE: Org GTD User Manual
:PREAMBLE:
#+AUTHOR: Aldric Giacomoni
#+EMAIL: trevoke@gmail.com
#+DATE: 2015-{{{year}}}
#+LANGUAGE: en

#+TEXINFO_DIR_CATEGORY: Emacs
#+TEXINFO_DIR_TITLE: Org GTD: (org-gtd)
#+TEXINFO_DIR_DESC: An opinionated GTD flow implemented in org-mode
#+TEXINFO_FILENAME: ../org-gtd.info
#+SUBTITLE: for version 4.0
#+TEXINFO_DEFFN: t
#+OPTIONS: H:3 num:3 toc:2
#+PROPERTY: header-args :eval never
#+MACRO: year (eval (format-time-string "%Y"))

Org GTD is an attempt to implement the GTD flow described in the GTD
book as faithfully as possible.

#+TEXINFO: @noindent
This manual is for Org GTD version 4.0

:END:
* Copying
:PROPERTIES:
:copying:  t
:END:
Copyright (C) 2018-{{{year}}} Aldric Giacomoni <trevoke@gmail.com>

You can redistribute this document and/or modify it under the terms
of the GNU General Public License as published by the Free Software
Foundation, either version 3 of the License, or (at your option) any
later version.

This document is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
General Public License for more details.

* Summary
:PROPERTIES:
:DESCRIPTION: quick intro to GTD
:END:
This package tries to replicate as closely as possible the GTD workflow (see diagram below).

This package, and this documentation, assume familiarity with the flow of GTD as described in the book.

This package provides a system that allows you to capture incoming things into an inbox, then process the inbox and categorize each item based on the GTD categories. It leverages org-agenda to show today's items as well as the NEXT items. It also has a simple project management system, which currently assumes all tasks in a project are sequential.
#+begin_example
                                    +-------+
                                    |"STUFF"|
                                    +---+---+
                                        |
                                    +---v---+
                                    | INBOX |
                                    +---+---+
                                        |              Eliminate  +-----------+
                                        |            +----------->|  Trash    |
                                 +------v------+     |            +-----------+
                                 | What is it? |     |
                                 +------+------+     |            +-----------+
                                        |            | Incubate   |  Someday/ |
                                        |            +----------->|   Maybe   |
+----------+  YES (multi-step)   +------v------+  NO |            +-----------+
| Projects |<--------------------|    Is it    |-----+
+-+----^---+                     | Actionable? |     | File       +-----------+
  |    |   +----------------+    +------+------+     +----------->| Reference |
  |    |        Review for  |           |                         +-----------+
+-v----+---+     Actions    |           |
| Planning |                +---------->| YES
+----------+                            |
                                 +------v------+     Less than
                       Delegate  | What's the  |     2 minutes    +-----------+
                     +-----------+    NEXT     +----------------->|   DO IT   |
                     |           |   Action?   |                  +-----------+
                     |           +------+------+
                     |                  |
                     |                  | FOR ME:
                     |                  |         Specific Date or Time
                     |                  +-------------------------------+
                     |              ASAP|                               |
               +-----v-----+      +-----v-----+                   +-----v-----+
               |           |      |           |                   |           |
               |           |      |           |                   |           |
               |           |      |           |                   |           |
               |           |      |           |                   |           |
               |           |      |           |                   |           |
               +-----------+      +-----------+                   +-----------+
                Waiting For        Next Actions                      Calendar
#+end_example
* What's new in 4.0
:PROPERTIES:
:CUSTOM_ID: new-in-4.0
:END:

Version 4.0 is a major release that transforms how Org GTD handles projects and configuration, while maintaining compatibility with your existing GTD data.

** Flexible project dependencies (the big one!)
Projects are no longer limited to sequential tasks! You can now create complex project structures with parallel tasks and custom dependencies.

- *Define any dependency relationship* - Tasks can block other tasks, creating a directed acyclic graph (DAG) of dependencies
- *Parallel work streams* - Multiple tasks can be NEXT at the same time if they don't depend on each other
- *Automatic dependency detection* - Org GTD finds all tasks that are ready to work on based on the dependency graph
- *Cycle prevention* - The system prevents circular dependencies that would create deadlocks
- *Visual dependency helper* (optional) - See task relationships in a side window while clarifying projects

Tasks without explicit dependencies still work sequentially (as before), so your existing projects continue to work unchanged.

** Simplified keyword configuration
The new keyword configuration system is clearer and more maintainable:

- *One mapping instead of many variables* - Replace individual keyword variables (~org-gtd-next~, ~org-gtd-todo~, etc.) with a single ~org-gtd-keyword-mapping~ structure
- *Global TODO keywords* - No more file-level ~#+TODO:~ lines that can conflict. Use Emacs' global ~org-todo-keywords~ configuration instead
- *Automatic validation* - Org GTD validates your keyword configuration and provides helpful error messages if something is wrong
- *Better Emacs 29+ support* - Use ~setopt~ for automatic validation when setting variables

See [[#all-the-levers][Configuration options]] for details.

** Data-driven configuration
New configuration system allows you to customize item properties declaratively:

- *Configure by item type* - Define what properties each GTD item type should have
- *Prompt for user input* - Automatically prompt for dates, text, or custom data when organizing
- *Extensible* - Easy to add your own custom configuration for new item types

** Declarative view language
Creating custom agenda views is now much easier with a declarative syntax:

- *Specify what you want, not how to get it* - Define views using simple filters instead of complex skip functions
- *Built on org-ql* - Leverages the powerful org-ql query language for performance
- *More maintainable* - View definitions are data structures, not code

** Better project modification
- *Add tasks to projects anywhere* - You can now add tasks to projects even if the project file is outside ~org-gtd-directory~
- *Modify project structure* - Commands to create task dependencies and manage complex projects

** Enhanced review capabilities
- *Find missed items* - New ~org-gtd-review-missed-items~ command to catch things that slipped through
- *Better stuck project detection* - Improved identification of projects that need attention

** Simplified configuration
- *org-gtd-mode is obsolete* - No need for a special mode anymore. Just configure ~org-agenda-files~ and ~org-edna~ directly in your init file. The old mode was wrapping all agenda commands unnecessarily and had org-edna configured incorrectly.

** What you need to do
If you're upgrading from 3.x, see the [[#upgrading][Upgrading section]] for complete step-by-step instructions. The required changes are:

1. Update your keyword configuration to use ~org-gtd-keyword-mapping~
2. Remove any ~#+TODO:~ lines from your GTD files
3. *Run the migration: ~M-x org-gtd-upgrade-v3-to-v4~* (required for projects to work!)

For new installations, just configure ~org-todo-keywords~ and ~org-gtd-keyword-mapping~ and you're ready to go.

** Previous versions
For changes in earlier versions, see:
- [[file:whats-new-3.0.org][What's new in 3.0]]

* Setting up Org GTD
** Upgrading
:PROPERTIES:
:DESCRIPTION: How to upgrade your local setup across major versions
:END:
If you are installing and not upgrading, you can skip this section entirely and just go to the next section, [[#Installing][Installing]].
*** 4.0.0 <- 3.x.x
Version 4.0 introduces major improvements to keyword configuration and project management. Your existing GTD data will continue to work, but you'll need to update your configuration and optionally migrate to take full advantage of new features.

**** Required: Configuration changes

**1. Update keyword configuration**

**OLD way (version 3.x):**
#+begin_src emacs-lisp
;; Individual keyword variables (no longer used)
(setq org-gtd-next "NEXT")
(setq org-gtd-todo "TODO")
(setq org-gtd-wait "WAIT")
(setq org-gtd-canceled "CNCL")
#+end_src

**NEW way (version 4.0):**
#+begin_src emacs-lisp
;; First, configure org-mode's global TODO keywords
;; All your GTD keywords must be in the same sequence
(setq org-todo-keywords
      '((sequence "TODO" "NEXT" "WAIT" "|" "DONE" "CNCL")))

;; Then map GTD semantic states to your keywords
;; Use setopt (Emacs 29+) for automatic validation, or setq for older versions
(setopt org-gtd-keyword-mapping
        '((todo . "TODO")      ;; tasks not ready to be acted upon
          (next . "NEXT")      ;; tasks ready to act on immediately
          (wait . "WAIT")      ;; tasks blocked or delegated
          (canceled . "CNCL"))) ;; tasks that won't be completed
#+end_src

Steps:
1. Remove old keyword variables (~org-gtd-next~, ~org-gtd-todo~, ~org-gtd-wait~, ~org-gtd-canceled~ and their ~-suffix~ variants) from your configuration
2. Remove any ~#+TODO:~ lines from your GTD org files (inbox.org, org-gtd-tasks.org, etc.)
3. Add the global keyword configuration to your Emacs init file
4. Ensure all GTD keywords appear in the *same sequence* in ~org-todo-keywords~

**** Required: Data migration

Version 4.0 changes how projects work internally. *The old TRIGGER-based system no longer functions* - v4 uses dependency properties instead. You MUST run the migration for your existing projects to continue working.

**Run the migration command:**

#+begin_src emacs-lisp
M-x org-gtd-upgrade-v3-to-v4
#+end_src

*Make a backup first!* The migration modifies your GTD files.

**What the migration does:**

The migration performs two steps automatically:

1. *Adds ORG_GTD properties* to identify items:
   - Adds ~ORG_GTD="Projects"~ to project headings
   - Adds ~ORG_GTD="Actions"~ to project tasks

2. *Converts projects to dependency-based system*:
   - Adds ~ORG_GTD_DEPENDS_ON~ and ~ORG_GTD_BLOCKS~ properties to create sequential task chains
   - Adds ~ORG_GTD_FIRST_TASKS~ property to project headings
   - Updates task states (NEXT/TODO) based on the new dependency graph

**After migration:**

- Your projects continue to work sequentially (task 1 → task 2 → task 3)
- The sequential behavior is now implemented via dependency properties instead of TRIGGER
- You can now customize dependencies for individual projects if you want parallel tasks
- Safe to run multiple times if needed

**** Why these changes?

**Keyword configuration:**
- Simpler: One mapping structure instead of multiple variables
- More reliable: Global configuration avoids file-level conflicts
- Better validation: Org GTD checks your configuration and provides helpful errors
- Future-proof: Easier to extend with new keyword types

**Property-based system:**
- More robust: Properties work reliably across different org-mode features
- More flexible: Enables features like multi-project tasks
- Better performance: Faster queries using org-ql

**** org-gtd-mode is obsolete

The ~org-gtd-mode~ minor mode is obsolete in version 4.0. It previously wrapped all org-agenda commands with org-gtd context, but this is no longer necessary because:

1. All org-gtd commands (like ~org-gtd-engage~) already have the right context
2. Users should configure ~org-agenda-files~ directly
3. Users should configure org-edna directly (the old mode had it configured incorrectly)

If you were using ~org-gtd-mode~, simply remove it and add these lines to your config:

#+begin_src emacs-lisp
(setq org-agenda-files (list org-gtd-directory))
(org-edna-mode 1)
#+end_src

** Installing
:PROPERTIES:
:DESCRIPTION: Get Org GTD in your emacs
:CUSTOM_ID: Installing
:END:
This package requires emacs 27.2 or higher.

This package is on MELPA and MELPA stable under the name ~org-gtd~.
*** use-package
Just make sure this is loaded after ~org-mode~ like so.
#+begin_src emacs-lisp
  (use-package org-gtd :after org)
#+end_src
*** Manually
Check out the source code for dependencies and install them.
Then, clone this repo to a directory of your choice, e.g. =~/.emacs.d/packages=.
Finally, add this to your config:
#+begin_src emacs-lisp
(add-to-list 'load-path "~/.emacs.d/packages")
(require 'org-gtd)
#+end_src
** Configuring
:PROPERTIES:
:DESCRIPTION: Required and optional system configuration
:CUSTOM_ID: configuring
:END:
*** Basic setup
You need to configure three things for org-gtd to work:

1. *TODO keywords*: Configure ~org-todo-keywords~ with your GTD workflow states
2. *Keyword mapping*: Map GTD semantic states to your keywords with ~org-gtd-keyword-mapping~
3. *org-edna*: Enable org-edna with inheritance for project dependencies to work

See the configuration sections below for details.

Note: ~org-gtd-mode~ is obsolete as of version 4.0. Just configure org-agenda-files and org-edna directly.

*** Complete Configuration Examples

*Configuration is the most critical part of setup.* The examples below are complete, working configurations you can copy-paste into your init file.

**** Example 1: Vanilla Emacs (Minimal Configuration)

This is the simplest possible configuration for org-gtd. Copy this entire block into your init file:

#+begin_src emacs-lisp
;; Configure org-mode TODO keywords
;; All GTD keywords MUST be in the same sequence
(setq org-todo-keywords
      '((sequence "TODO" "NEXT" "WAIT" "|" "DONE" "CNCL")))

;; Map GTD semantic states to your keywords
(setq org-gtd-keyword-mapping
      '((todo . "TODO")      ; tasks not ready to act on
        (next . "NEXT")      ; tasks ready to act on immediately
        (wait . "WAIT")      ; tasks blocked or delegated
        (canceled . "CNCL"))) ; tasks that won't be completed

;; Optional: Set GTD directory (defaults to ~/gtd/)
;; (setq org-gtd-directory "~/my-gtd/")

;; Add org-gtd files to your agenda
(setq org-agenda-files (list org-gtd-directory))

;; REQUIRED: Enable org-edna for project dependencies
(org-edna-mode 1)

;; Global keybindings for GTD commands
;; These work anywhere in Emacs
(global-set-key (kbd "C-c d c") 'org-gtd-capture)
(global-set-key (kbd "C-c d e") 'org-gtd-engage)
(global-set-key (kbd "C-c d p") 'org-gtd-process-inbox)
(global-set-key (kbd "C-c d n") 'org-gtd-show-all-next)
(global-set-key (kbd "C-c d s") 'org-gtd-review-stuck-projects)

;; Keybinding for clarify map
;; This only works when you're in a clarify buffer
(with-eval-after-load 'org-gtd
  (define-key org-gtd-clarify-map (kbd "C-c c") 'org-gtd-organize))
#+end_src

**** Example 2: Doom Emacs Configuration

If you use Doom Emacs, add this to your ~packages.el~:

#+begin_src emacs-lisp
(package! org-gtd)
#+end_src

Then add this to your ~config.el~:

#+begin_src emacs-lisp
(use-package! org-gtd
  :after org
  :custom
  (org-gtd-directory "~/gtd/")
  (org-todo-keywords '((sequence "TODO" "NEXT" "WAIT" "|" "DONE" "CNCL")))
  (org-gtd-keyword-mapping '((todo . "TODO")
                             (next . "NEXT")
                             (wait . "WAIT")
                             (canceled . "CNCL")))
  (org-agenda-files (list org-gtd-directory))
  :config
  (org-edna-mode)
  ;; Doom-style leader key bindings
  (map! :leader
        (:prefix ("d" . "org-gtd")
         :desc "Capture"        "c"  #'org-gtd-capture
         :desc "Engage"         "e"  #'org-gtd-engage
         :desc "Process inbox"  "p"  #'org-gtd-process-inbox
         :desc "Show all next"  "n"  #'org-gtd-show-all-next
         :desc "Stuck projects" "s"  #'org-gtd-review-stuck-projects))
  ;; Clarify map binding
  (map! :map org-gtd-clarify-map
        :desc "Organize this item" "C-c c" #'org-gtd-organize))
#+end_src

**** Example 3: Spacemacs Configuration

If you use Spacemacs, add this to your ~dotspacemacs/user-config~ function:

#+begin_src emacs-lisp
;; Install org-gtd
(use-package org-gtd
  :ensure t
  :after org
  :init
  ;; Configure org-mode TODO keywords
  (setq org-todo-keywords
        '((sequence "TODO" "NEXT" "WAIT" "|" "DONE" "CNCL")))
  ;; Map GTD semantic states
  (setq org-gtd-keyword-mapping
        '((todo . "TODO")
          (next . "NEXT")
          (wait . "WAIT")
          (canceled . "CNCL")))
  ;; Optional: Set GTD directory
  (setq org-gtd-directory "~/gtd/")
  ;; Add to agenda files
  (setq org-agenda-files (list org-gtd-directory))
  :config
  ;; REQUIRED: Enable org-edna for project dependencies
  (org-edna-mode 1)
  ;; Spacemacs leader key bindings
  (spacemacs/set-leader-keys
    "od c" 'org-gtd-capture
    "od e" 'org-gtd-engage
    "od p" 'org-gtd-process-inbox
    "od n" 'org-gtd-show-all-next
    "od s" 'org-gtd-review-stuck-projects)
  ;; Clarify map binding
  (with-eval-after-load 'org-gtd
    (define-key org-gtd-clarify-map (kbd "C-c c") 'org-gtd-organize)))
#+end_src

**** What These Configurations Do

All three examples configure the same essential pieces:

1. *~org-todo-keywords~* - Defines the workflow states (TODO → NEXT → WAIT → DONE/CNCL)
   - The ~|~ separator marks done states (right side) vs active states (left side)
   - All GTD keywords must be in a single sequence

2. *~org-gtd-keyword-mapping~* - Maps GTD concepts to your keyword choices
   - ~todo~ - Tasks not yet actionable
   - ~next~ - Tasks ready to work on right now
   - ~wait~ - Tasks blocked or delegated
   - ~canceled~ - Tasks that won't be done

3. *~org-gtd-directory~* - Where org-gtd keeps its files (defaults to =~/gtd/=)

4. *~org-agenda-files~* - Makes org-gtd items appear in agenda views

5. *~org-edna-mode~* - REQUIRED for projects to work

6. *Keybindings* - Two types:
   - *Global bindings*: Work anywhere in Emacs (capture, engage, process, etc.)
   - *Clarify map binding*: Only works when organizing items in clarify buffers

**** Testing Your Configuration

After adding one of the configurations above and restarting Emacs, verify everything works:

**Test 1: Capture works**

#+begin_example
M-x org-gtd-capture
#+end_example

Expected: Opens a capture buffer for the inbox.

If it fails: Check that ~org-gtd-directory~ exists and you have write permissions.

**Test 2: Engage works**

#+begin_example
M-x org-gtd-engage
#+end_example

Expected: Opens an agenda view (might be empty if you haven't organized anything yet).

If it fails: Check that ~org-agenda-files~ includes your GTD directory.

**Test 3: Keywords are recognized**

1. Open any org file: ~M-x find-file ~/test.org~
2. Type: ~* Test heading~
3. Put cursor on the heading
4. Try cycling TODO states: ~C-c C-t~

Expected: Should cycle through TODO → NEXT → WAIT → DONE → CNCL.

If it fails: Check that ~org-todo-keywords~ is set correctly.

**Test 4: org-edna is enabled**

#+begin_example
M-x describe-variable RET org-edna-mode
#+end_example

Expected: Should show "t" (enabled).

If it fails: Make sure ~(org-edna-mode 1)~ is in your config and you've restarted Emacs.

**** Common Configuration Problems

Before troubleshooting, identify which configuration style you're using:
- *Vanilla Emacs*: See [[#example-1-vanilla-emacs-minimal-configuration][Example 1: Vanilla Emacs]]
- *Doom Emacs*: See [[#example-2-doom-emacs-configuration][Example 2: Doom Emacs]]
- *Spacemacs*: See [[#example-3-spacemacs-configuration][Example 3: Spacemacs]]

Each example shows the complete, correct configuration for that environment.

**Problem: "org-gtd-capture" is undefined**

*Cause*: org-gtd package isn't installed or loaded.

*Solution*:
- *Vanilla Emacs*: Install from MELPA with ~M-x package-install RET org-gtd RET~
- *Doom Emacs*: Add ~(package! org-gtd)~ to your ~packages.el~ and run ~doom sync~
- *Spacemacs*: The ~use-package~ form in the [[#example-3-spacemacs-configuration][Spacemacs example]] automatically installs it with ~:ensure t~

**Problem: Keywords don't change when I press C-c C-t**

*Cause*: ~org-todo-keywords~ not configured correctly.

*Solution*: Check your configuration has this setting:
#+begin_src emacs-lisp
(setq org-todo-keywords
      '((sequence "TODO" "NEXT" "WAIT" "|" "DONE" "CNCL")))
#+end_src

Common mistakes:
- Keywords not in quotes: Should be ~"TODO"~ not ~TODO~
- Missing sequence wrapper: Need ~'((sequence ...))~ not just ~'("TODO" ...)~
- No done separator: Need ~|~ before ~"DONE"~ and ~"CNCL"~

See the complete configuration for your environment above.

**Problem: Projects don't advance when I mark tasks DONE**

*Cause*: org-edna isn't enabled.

*Solution*: All three configuration examples include ~(org-edna-mode 1)~. Make sure you have:
- *Vanilla/Spacemacs*: ~(org-edna-mode 1)~ in the ~:config~ section
- *Doom*: ~(org-edna-mode)~ in the ~:config~ section (Doom handles the argument)

**Problem: Can't see GTD items in agenda**

*Cause*: GTD directory not in ~org-agenda-files~.

*Solution*: All three configuration examples include this. Check you have:
#+begin_src emacs-lisp
(setq org-agenda-files (list org-gtd-directory))
#+end_src

Or if using ~use-package~ / ~use-package!~:
#+begin_src emacs-lisp
:custom
(org-agenda-files (list org-gtd-directory))
#+end_src

**Problem: Keybindings don't work**

*Cause*: Keybindings not defined, or defined incorrectly for your environment.

*Solution*:
- *Vanilla Emacs*: Use ~global-set-key~ for global commands, ~define-key org-gtd-clarify-map~ for clarify buffer commands
- *Doom Emacs*: Use ~map!~ with ~:leader~ prefix for global, ~:map org-gtd-clarify-map~ for clarify buffer
- *Spacemacs*: Use ~spacemacs/set-leader-keys~ for global, ~define-key~ for clarify buffer

The clarify binding (~C-c c~) *only works in clarify buffers* - you must run ~M-x org-gtd-process-inbox~ first.

See the complete configuration for your environment to copy the correct keybinding syntax.

*** Understanding Keybindings

org-gtd uses two types of keybindings, and understanding the difference is important:

**** Global Keybindings

These work *anywhere* in Emacs and let you access the main GTD commands:

#+begin_src emacs-lisp
;; These commands are always available:
(global-set-key (kbd "C-c d c") 'org-gtd-capture)       ; Capture to inbox
(global-set-key (kbd "C-c d e") 'org-gtd-engage)        ; Daily view
(global-set-key (kbd "C-c d p") 'org-gtd-process-inbox) ; Process inbox
(global-set-key (kbd "C-c d n") 'org-gtd-show-all-next) ; Show NEXT actions
#+end_src

You can use any key combination you prefer. The ~C-c d~ prefix is just a convention.

**** Clarify Map Keybindings

These only work when you're in a *clarify buffer* (during inbox processing). The most important one is:

#+begin_src emacs-lisp
;; This only works in clarify buffers:
(define-key org-gtd-clarify-map (kbd "C-c c") 'org-gtd-organize)
#+end_src

**When you're in a clarify buffer:**
1. You've called ~org-gtd-process-inbox~ and are looking at an item
2. You've edited the item to make it clear and actionable
3. Now you press ~C-c c~ to organize it (choose its type: project, single action, etc.)

**Why the distinction?**

The clarify map is a separate keymap because:
- It prevents conflicts with other org-mode bindings
- It only activates when you need it (during processing)
- You can bind different keys for organizing without affecting the rest of Emacs

**Common patterns:**

Most users bind:
- ~C-c d *~ for global commands (capture, engage, process)
- ~C-c c~ for organizing (only in clarify buffers)

But you can use whatever works for your workflow!

*** Required configuration of sub-packages
:PROPERTIES:
:CUSTOM_ID: configuring-sub-packages
:END:
**** Configuring org-edna
:PROPERTIES:
:CUSTOM_ID: configuring-org-edna
:END:
package: https://www.nongnu.org/org-edna-el/

This configuration is *REQUIRED* for project dependencies to work correctly. It enables org-edna to automatically update task states when you complete tasks in a project.

#+begin_src emacs-lisp
(org-edna-mode 1)
#+end_src

**** Adding org-gtd files to your agenda

To see org-gtd items in your agenda views, add the org-gtd directory to your ~org-agenda-files~:

#+begin_src emacs-lisp
;; If you only want GTD files in your agenda:
(setq org-agenda-files (list org-gtd-directory))

;; Or if you have other agenda files, add GTD to the list:
(add-to-list 'org-agenda-files org-gtd-directory)
#+end_src
*** configuration options for org-gtd
**** I don't care, just let me start using it
The most direct way to find out about the configuration options for org-gtd is to see the customize group: ~M-x customize-group RET org-gtd~. They are all optional because they all come with default values.

The only one you may want to change before starting to use Org GTD is ~org-gtd-directory~, which is the directory that Org GTD
will look to for everything it needs to do.

The configuration options will also be mentioned in the relevant subsections of [[#using-org-gtd][Using Org GTD]].
**** Tell me all the levers I can pull
:PROPERTIES:
:CUSTOM_ID: all-the-levers
:END:

Make sure you also read about sub-package configuration: [[#configuring-sub-packages][Required configuration of sub-packages]].

***** Required keyword configuration

These settings are *required* for Org GTD to work properly:

- ~org-todo-keywords~ :: (=org-mode= variable) Define your TODO keyword sequences here. All GTD keywords (TODO, NEXT, WAIT, DONE, CNCL or your custom versions) *must* be in the same sequence. Example:
  #+begin_src emacs-lisp
  (setq org-todo-keywords
        '((sequence "TODO" "NEXT" "WAIT" "|" "DONE" "CNCL")))
  #+end_src

- ~org-gtd-keyword-mapping~ :: Map GTD semantic states to your chosen keywords. This tells Org GTD which keyword means what. The four required mappings are:
  - ~todo~ :: Tasks not ready to be acted upon
  - ~next~ :: Tasks ready to act on immediately
  - ~wait~ :: Tasks blocked or delegated to someone else
  - ~canceled~ :: Tasks that won't be completed

  Example configuration (use ~setopt~ for Emacs 29+ to get automatic validation):
  #+begin_src emacs-lisp
  (setopt org-gtd-keyword-mapping
          '((todo . "TODO")
            (next . "NEXT")
            (wait . "WAIT")
            (canceled . "CNCL")))
  #+end_src

  Or for older Emacs versions:
  #+begin_src emacs-lisp
  (setq org-gtd-keyword-mapping
        '((todo . "TODO")
          (next . "NEXT")
          (wait . "WAIT")
          (canceled . "CNCL")))
  #+end_src

***** Optional configuration

- ~org-gtd-directory~ :: set this to a directory. =org-gtd= will look for all its files in this directory.
- ~org-gtd-capture-templates~ :: (!note: take care when changing this) This defines the pre-filled text that will show up when capturing an item to the inbox. The only requirements are that the template string must define an org-mode top-level heading, and that the entry point to the inbox.  That is to say, the first two characters must be a single asterisk followed by a space: ~"* "~, and the entry type must be like this: =entry  (file ,#'org-gtd-inbox-path)=. [[#adding-things-to-the-inbox][Adding things to the inbox]].
- ~org-reverse-note-order~ :: (=org-mode= variable) set this to ~t~ to add new items to the top of project tasks and to ~nil~ to add new items to the bottom of project tasks when organizing an item as such.
- ~org-gtd-organize-hooks~ :: this is a list of functions that you can use to decorate each item when you clarify it. For instance, you could add a function to set the effort, or the priority, or some category, etc. By default it has only one function, which lets you add tags, but of course you can change this entirely. [[#organizing-an-item][Organizing an item]].
- ~org-gtd-archive-location~ :: Points to a function to generate the archive file dynamically. Default value generates a file suffixed with the current year. The function has an arity of zero and generates an org-mode file+outline path. [[#cleaning-up-the-system][Cleaning up / archiving completed work]].
- ~org-gtd-refile-to-any-target~ :: when ~t~, =org-gtd= will refile to the first target it finds, and create a target if it doesn't find one. When false, it will ask for confirmation before refiling. [[#refiling-after-organizing][Refiling to the appropriate area]].
- ~org-gtd-delegate-read-func~ :: function that is used to prompt for a person a task is delegated to. Must return a string. By default this is set to ~read-string~.
- ~org-gtd-areas-of-focus~ :: list of strings representing your areas of focus (horizon 2 in GTD).
- ~org-gtd-clarify-show-horizons~ :: When clarifying, do you want the horizons buffer to be shown by default, or do you prefer it hidden?
- ~org-gtd-clarify-project-templates~ :: Alist of strings: ~project template name . project template~ where there template is a series of tasks you may want to insert automatically, if you have a generic type of project that comes up a lot.
- ~org-gtd-horizons-file~ :: Name of the file, in ~org-gtd-directory~, that will be displayed when the horizons buffer is displayed when clarifying.
- ~org-gtd-engage-prefix-width~ :: how many characters to dedicate to the prefix, on the left side of the TODO items, so the project name, if any, can show clearly.
*** Recommended key bindings
:PROPERTIES:
:CUSTOM_ID: recommended-key-bindings
:END:

There's an important keymap you'll want to make the flow of processing the inbox smoother. To limit impact on your emacs configuration, there is a specific keymap you can use. The function you'll want to bind is ~org-gtd-organize~. I suggest ~C-c c~, as in the following example.

#+begin_src elisp
(define-key org-gtd-clarify-map (kbd "C-c c") #'org-gtd-organize)
#+end_src

For other keybindings, do what you need. My bindings use ~C-c d~ as a prefix, i.e.:

- ~C-c d c~ :: ~org-gtd-capture~
- ~C-c d e~ :: ~org-gtd-engage~

etc.
*** Sample Doom Emacs Config
If you are a Doom Emacs user, then your configuration may look something like this:

#+BEGIN_SRC elisp
  (use-package! org-gtd
    :after org
    :custom
    (org-gtd-directory "~/gtd/")
    (org-todo-keywords '((sequence "TODO" "NEXT" "WAIT" "|" "DONE" "CNCL")))
    (org-gtd-keyword-mapping '((todo . "TODO")
                               (next . "NEXT")
                               (wait . "WAIT")
                               (canceled . "CNCL")))
    (org-agenda-files (list org-gtd-directory))
    :config
    (org-edna-mode)
    (map! :leader
          (:prefix ("d" . "org-gtd")
           :desc "Capture"        "c"  #'org-gtd-capture
           :desc "Engage"         "e"  #'org-gtd-engage
           :desc "Process inbox"  "p"  #'org-gtd-process-inbox
           :desc "Show all next"  "n"  #'org-gtd-show-all-next
           :desc "Stuck projects" "s"  #'org-gtd-review-stuck-projects))
    (map! :map org-gtd-clarify-map
          :desc "Organize this item" "C-c c" #'org-gtd-organize))
#+END_SRC
* Using Org GTD
:PROPERTIES:
:DESCRIPTION: How Org GTD maps to the GTD flow
:CUSTOM_ID: using-org-gtd
:END:
** Org-mode building blocks for Org GTD
This section introduces how Org GTD leverages org-mode.

Org Gtd uses ~org-edna~ to automatically trigger state changes in projects, such that when you mark a NEXT item from a project as DONE, the next TODO in that project automatically becomes NEXT, such that the agenda is always up-to-date (you may need to refresh the agenda).

Org GTD uses org keywords to figure out the relevant state of each task. By default, these are ~TODO~, ~NEXT~, ~WAIT~, ~DONE~, and ~CNCL~. You can configure these using ~org-todo-keywords~ and map them to GTD semantic states using ~org-gtd-keyword-mapping~ (see [[#all-the-levers][Tell me all the levers I can pull]]).

Org GTD uses the following properties:
- ~ORG_GTD~ :: top-level property, used for simple filtering when it comes to agenda views
- ~ORG_GTD_TIMESTAMP~ :: where the timestamp for appointments and other date-relevant actions is stored. It's separate from everything else org-mode related in order to allow you, the user, to use ~SCHEDULED~, ~DEADLINE~, or even plain timestamps as you see fit.
- ~DELEGATED_TO~ :: used by a dependency, ~org-agenda-property~, to show the name of the person to whom the task is delegated in the agenda view.
** The GTD flow
Here are the domain elements of GTD that we handle:
*** Adding things to the inbox
:PROPERTIES:
:CUSTOM_ID: adding-things-to-the-inbox
:END:

The trip through GTD arguably begins by adding things to the inbox. The inbox is a file called ~inbox.org~ in the directory stored in the variable ~org-gtd-directory~. By default this means the file will be ~~/gtd/inbox.org~.

Org GTD provides one function to capture items: ~M-x org-gtd-capture~. In my setup I have this bound globally as such:

#+begin_src elisp
(global-set-key "C-c d c" #'org-gtd-capture)
#+end_src

This function uses the variable ~org-gtd-capture-templates~ to define org-gtd-specific capture templates. By default it comes with two templates, one to just capture a new item, and one to capture an item with a link to the file where you were when you started the capture.

You can customize these templates as you see fit. In order to maintain proper functioning of org-gtd, however, there are two constraints:

1. the first two characters of the template string must be a single asterisk followed by a space: ~"* "~
2. the entry type must be like this: =entry  (file ,#'org-gtd-inbox-path)=

*** Processing the inbox
:PROPERTIES:
:CUSTOM_ID: processing-the-inbox
:END:
Processing the inbox means taking everything in the inbox, one at a time, and refining/categorizing them so they are instantly useful when you are looking at available next / scheduled actions.

You can start processing the inbox with ~org-gtd-process-inbox~. This starts a looping behavior of clarifying each item in the inbox.

*** Clarifying each item
:PROPERTIES:
:CUSTOM_ID: clarification
:END:
Clarifying an item means editing and adding the information that will be most valuable to you to the item. Note that task-specific information, such as appointment date, or name of person to whom it is delegated, or even area of focus, will be added during the Organize step, so don't worry about these yet.
**** How to start clarifying
Besides ending up in here automatically while processing the inbox, there's two more ways to enter the clarifying flow:

- ~org-gtd-clarify-item~ :: call this from any org-mode heading to do a one-off clarification.
- ~org-gtd-clarify-agenda-item~ :: call this from the agenda view, if you have anything you want to re-clarify, or possibly clarify for the first time, from somewhere outside the inbox.

**** data shape requirements
:PROPERTIES:
:CUSTOM_ID: data-shape-requirement-while-clarifying
:END:
There's two general shapes you'll be looking for.
Almost everything will look like a simple org-mode heading.
For instance, ~* Task desc~.


The only exception will be a project, that will look like a top-level heading for the project description with, underneath, a series of second-level headings representing each task to be executed sequentially before the project is complete.

#+begin_example
,* Project heading
,** First task
,** Second task
,** Third task
#+end_example

**** Options and commands related to clarification
:PROPERTIES:
:CUSTOM_ID: options-and-behaviors-related-to-clarification-step
:END:
The clarify buffers are ~org-mode~ buffers that use the minor mode ~org-gtd-clarify-mode~. There is a keymap, ~org-gtd-clarify-map~, that you can use to bind useful

While clarifying, you may find it useful to see your GTD horizons. You can use:
- ~org-gtd-clarify-toggle-horizons-window~ :: a function that toggles the display of the horizons buffer
- ~org-gtd-clarify-show-horizons~ :: a boolean variable defining whether the horizons window should be shown (t) or hidden (nil) by default when clarifying an item. See  [[#working-with-horizons][Working with the GTD Horizons]] for more details.

If you are clarifying a project, you may be interested in project templates:
- ~org-gtd-clarify-project-insert-template~ :: a function that will ask you to choose a template to insert.
- ~org-gtd-clarify-project-templates~ :: an alist of the form =(name . template)= where both name and template are strings. =name= will be used in the interactive menu, and =template= will be inserted in the buffer.

*** Organizing an item into the system
:PROPERTIES:
:CUSTOM_ID: organizing-an-item
:END:
When you are done clarifying, call ~M-x org-gtd-organize~ (or hit your keybinding for it, see [[#recommended-key-bindings][Recommended key bindings]]). This will open a transient menu to let you choose how Org GTD should categorize this item.

Organizing is broken up into three steps:
- Choosing a task type
- Applying hooks to add additional relevant information
- Refiling to the appropriate area

**** Choosing a task type
Here are the following task types you can choose.

- *[P]rojects :: This is a multi-step action. In Org GTD, this is defined as a top-level org heading with a set of second-level org headings representing the tasks. By default, tasks execute sequentially (first task must complete before second becomes NEXT, etc.). You can also create custom dependencies between tasks for parallel work or complex project structures. See [[#working-with-projects][Working with projects]] for details on managing task dependencies.
- *[A]dd to existing project :: Add current task to pre-existing project. See ~org-reverse-note-order~ to choose a default position (first or last) for this new task. You can always adjust this yourself later, then put your point on the project heading and call ~org-gtd-projects-fix-todo-keywords-for-project-at-point~ to have Org GTD clean it up for you.
- *[C]alendar* :: Single action to be done at a given date or time. Org GTD will ask you for a date/time for this appointment.
- *[D]elegate :: Let someone else do this. Org GTD will ask you for a name to whom to delegate to and a date/time when to check up on the task with that person. You can customize ~org-gtd-delegate-read-func~ to specify a custom name input function (e.g. for completion purposes).
- *[S]ingle action* :: This is a one-off to be done when possible.
- *[H]abit* :: org-mode-style habit. Org GTD will ask you for a valid org-mode repeating stamp and a date when to start the habit tracking. See the org-mode documentation for more information.
- *[I]ncubate* :: no action now; review later. Org GTD will ask you for a date at which it should remind you about this.
- *[Q]uick action :: Less than 2 minutes. Do it now, then choose this to mark the item as DONΕ and archive it.
- *[K]nowledge* :: This is knowledge to be stored away. Choose this *after* you have properly saved this item as knowledge.
- *[T]rash* :: Not actionable; not knowledge. Discard this item.

**** Applying hooks
The decorations (priority, tags, categories, etc.) are customizable as you desire and managed by ~org-gtd-organize-hooks~, a list of functions. You can add your own functions to this list, as long as the functions do not modify the text in any "custom" way, separate from what org-mode understands.

See [[#hooks-framework][Adding your own hooks when organizing]] for more details on how you can add your own or customize this further.

**** Refiling to the appropriate area
:PROPERTIES:
:CUSTOM_ID: refiling-after-organizing
:END:
By default, org-gtd will refile to a single file in the directory, but you can create your own headings if you find it helpful.

If you would like to add new refile targets, it's simple, follow these instructions.
***** New project heading
Add a top-level heading in any ~.org~ file (including a new one) in ~org-gtd-directory~ and make sure its property drawer matches the one in the constant ~org-gtd-projects-template~.
***** Other headings
Create a new top-level heading in any ~.org~ file (including a new one) in ~org-gtd-directory~ and make sure its property drawer matches the one in the relevant template constant:

- ~org-gtd-habit-template~
- ~org-gtd-calendar-template~
- ~org-gtd-incubate-template~
- ~org-gtd-action-template~

Here is an example:

#+begin_src org-mode
:PROPERTIES:
:ORG_GTD: Action
:END:
#+end_src

*** Engaging with your GTD items

You can see a list of all NEXT actions, and scheduled actions, with ~M-x org-gtd-engage~ .

You can call ~org-gtd-show-all-next~ to only see NEXT actions, nothing scheduled.

You can use ~org-gtd-oops~ to see all the appointments you missed, and act on them accordingly.

The weekly review is not yet implemented.

*** Working with the GTD Horizons
:PROPERTIES:
:CUSTOM_ID: working-with-horizons
:END:
In GTD, the horizons are defined as such:

- Ground :: the day-to-day
- Horizon 1 :: projects
- Horizon 2 :: areas of focus
- Horizon 3 :: 1-2 year goals
- Horizon 4 :: 3-5 year vision
- Horizon 5 :: purpose and principles

Obviously, Ground and Horizons 1 are handled by the "capture/clarify/organize/engage" flow we've already seen.

GTD recommends that you do not start using the horizons above Horizon 1 until you have both Ground and Horizon 1 under control. So, when you are ready...

**** Areas of focus
Horizon 2 is now handled by a variable and a hook you can add to ~org-gtd-organize-hooks~:
- ~org-gtd-areas-of-focus~ is a list of strings, each representing one of your areas of focus.
- ~org-gtd-set-area-of-focus~ is the hook you would add, e.g. ~(setq org-gtd-organize-hooks '(org-gtd-set-area-of-focus))~, it ensures each item you clarify will need to be part of a horizon.

You can then use the function ~org-gtd-review-area-of-focus~ to generate an agenda view to review a specific area of focus.

In order to add areas of focus to pre-existing items in your system, without going through the clarifying flow, we provide two functions:
- ~org-gtd-area-of-focus-set-on-item-at-point~, when you are on a org heading
- ~org-gtd-area-of-focus-set-on-agenda-item~, when you are on an agenda item

Do note that calling the function on item at point will trust you blindly to do the right thing, whereas setting the area of focus through the agenda will attempt to recognize if you are on a project task and thus set the category on the project itself instead of the task.

**** Longer-term horizons
The longer-term horizons can be stored in a file in the ~org-gtd-directory~. A variable governs the name of the file, ~org-gtd-horizons-file~, by default =horizons.org=.

At the moment it does not seem particularly useful to add any automation around these, since they will change so infrequently.

They are, however, useful to display.

A variable, ~org-gtd-clarify-show-horizons~, determines whether/where to display the side buffer while clarifying.

Regardless of the value of this variable, you can use the function ~org-gtd-clarify-toggle-horizons-window~ to display or hide the side window. If the above variable is nil, then the horizons window will be toggled on the right side of the screen.

*** Working with projects
:PROPERTIES:
:CUSTOM_ID: working-with-projects
:END:

Projects in Org GTD are multi-step actions represented as a top-level heading with task sub-headings underneath. Version 4.0 introduces flexible task dependencies, allowing you to create complex project structures.

**** Default sequential behavior
By default, tasks in a project work sequentially - when you complete the first task, the second task automatically becomes NEXT. This happens automatically without any configuration needed.

**** Creating custom dependencies
You can create more complex dependency relationships between tasks:

- *Parallel tasks* - Multiple tasks can be NEXT at the same time if they don't depend on each other
- *Custom blocking relationships* - Define which tasks must complete before others can start
- *Directed acyclic graph (DAG)* - Tasks form a dependency graph where work flows from blockers to blocked tasks

The system automatically prevents circular dependencies that would create deadlocks.

**** Dependency properties
Task dependencies are managed through two org properties:

- ~ORG_GTD_DEPENDS_ON~ - Contains IDs of tasks that must complete before this task can start (this task is blocked by those tasks)
- ~ORG_GTD_BLOCKS~ - Contains IDs of tasks that this task blocks (those tasks depend on this one)

These properties are managed automatically when you use the dependency commands.

**** Visualizing dependencies (optional)
You can enable a visual dependency helper while clarifying projects:

#+begin_src emacs-lisp
(setq org-gtd-clarify-display-helper-buffer t)
#+end_src

When enabled, a side window shows task relationships as you work on a project in the WIP buffer.

**** Fixing project keywords
If tasks in a project get out of sync, you can fix them with:

- ~org-gtd-projects-fix-todo-keywords-for-project-at-point~ - When point is on a project heading, this recalculates which tasks should be NEXT based on the dependency graph

*** Cleaning up / archiving completed work
:PROPERTIES:
:CUSTOM_ID: cleaning-up-the-system
:END:
Doing this without user intervention is tricky, as it makes undoing actions more complicated. As such, Org GTD provides a function that will go through the ~org-gtd-directory~ files, find the headings that belong to Org GTD (see [[#refiling-after-organizing][Refiling to the appropriate area]]), and archive the finished items.

The variable ~org-gtd-archive-location~ points to a *function* that returns a string matching the ~org-archive-location~ definition. It is a function in order to allow the filename to be dynamic.

The function to archive everything is ~M-x org-gtd-archive-completed-items~.
*** Commands you can call on org-agenda
Since Org provides the agenda, it is a convenient base of operations for interacting with things that come up through ~org-gtd-engage~.

Here are the actions available to you:

- ~M-x org-gtd-delegate-agenda-item~ :: When the point is on an action, this will properly delegate the action to someone else.
- ~M-x org-gtd-project-cancel-from-agenda~ :: When the point is on a project action, this command will cancel the remaining actions in the project.
- ~M-x org-gtd-clarify-agenda-item~ :: If you would like to clarify and organize an item through the agenda view, for whatever reason, this is your entry point.

*** Defining your own agenda views
You can define your own agenda views by defining your own functions like shown below, where =x= is whatever your defined key is.

#+begin_src elisp
  (defun my-agenda ()
    (with-org-gtd-context
        (let ((org-agenda-custom-commands '(your-definition-here)))
          (org-agenda nil "x"))))
#+end_src
*** Adding your own hooks when organizing
:PROPERTIES:
:CUSTOM_ID: hooks-framework
:END:
Adding useful metadata to the tasks allows you to enhance the agenda view to make it more useful to you, whether it be effort, tags, priority, or any other amount of information you might like.

This being said, different types of tasks or items are not even created equal. For instance, there may be metadata you want to add to a project heading but not its tasks, or to a calendar item and not to a trash item.

Org GTD therefore provides a helper function, ~org-gtd-organize-type-member-p~, which you can use when creating your own hooks. The function takes one argument, a list of types (provided in the function's documentation).
When called as part of a hook, this function will check a buffer-local variable called ~org-gtd--organize-type~, managed by Org GTD, to determine truthiness.

For an example, see the source code for ~org-gtd-areas-of-focus--set~, which will not run if the task being organized is a project task, trash, knowledge, or a quick action.
** Automating through emacs
There's now a few functions you can use when you are doing work within emacs and would like GTD to track something for you as a result:
- ~org-gtd-habit-create~
- ~org-gtd-calendar-create~
- ~org-gtd-delegate-create~
- ~org-gtd-incubate-create~
- ~org-gtd-single-action-create~

See the documentation for each, but suffice it to say they all take, at the very least, a string that will be used as the text part of the org heading that gets stored in org-gtd.

For instance, one way this could work:

#+begin_src emacs-lisp
  (defun org-gtd-email-reminder ()
    (let ((topic (message-fetch-field "subject"))
          (delegated-to (message-fetch-field "to"))
          (reminder-date (org-read-date nil nil "+3d")))
      (org-gtd-delegate-create (format "Reminder: %s" topic)
                               delegated-to
                               reminder-date)))

  (add-hook 'message-send-hook 'org-gtd-email-reminder)
#+end_src

* Troubleshooting
** Finding lost tasks
Sometimes things break. The following functions will help you find these items:

- ~org-gtd-review-stuck-calendar-items~
- ~org-gtd-review-stuck-incubated-items~
- ~org-gtd-review-stuck-habit-items~
- ~org-gtd-review-stuck-delegated-items~
- ~org-gtd-review-stuck-single-action-items~
- ~org-gtd-review-stuck-projects~
- ~org-gtd-review-missed-items~

** Projects without a NEXT item

~org-edna~ needs to be configured and enabled, see [[#configuring-org-edna][Configuring org-edna]].

To fix such a stuck project, put the point on the project heading and call ~M-x org-gtd-projects-fix-todo-keywords-for-project-at-point~.
** I can't create a project when clarifying an inbox item!
See [[#data-shape-requirement-while-clarifying][data shape requirements]]. If this does not help you, please open an issue and show exactly what you have done before asking =org-gtd= to create a project.
